<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Sederhana: Prediksi Stok Kain</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />

    <style>
      /* CSS Kustom Tambahan */
      body {
        background-color: #f8f9fa;
      }
      .header-bg {
        background-color: #4caf50;
        color: white;
        padding: 20px 0;
        margin-bottom: 20px;
        border-radius: 0.5rem;
      }
      .kritis {
        background-color: #f8d7da;
        color: #721c24;
        font-weight: bold;
      }
      .perlu {
        background-color: #fff3cd;
        color: #856404;
      }
      .aman {
        background-color: #d4edda;
        color: #155724;
      }
      .factor-group {
        border: 1px solid #ced4da;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        background-color: #e9ecef;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <div class="text-center header-bg shadow-sm">
        <h1>ðŸ’¡ AI Sederhana: Prediksi Kebutuhan Stok</h1>
        <p class="lead">Kelola inventaris toko kain Anda dengan lebih cerdas!</p>
      </div>

      <div class="card shadow-lg p-4 mb-4">
        {% if is_custom_data %}
        <div class="alert alert-success" role="alert"><strong>Data Historis Aktif:</strong> Berdasarkan file CSV kustom Anda. Jumlah Kain Terdeteksi: {{ nama_kain | length }}.</div>
        {% else %}
        <div class="alert alert-info" role="alert"><strong>Data Historis Aktif:</strong> Menggunakan data fiktif (fallback) bawaan. Harap unggah CSV Anda.</div>
        {% endif %}

        <h2 class="card-title text-primary">1. Unggah Data Historis (CSV)</h2>
        <form method="POST" enctype="multipart/form-data" class="mb-4 border p-3 rounded">
          <label for="file" class="form-label fw-bold">Pilih File CSV Penjualan (Kolom 1: Identifier, Kolom 2+: Data Kain)</label>
          <input type="file" name="file" id="file" class="form-control" accept=".csv" required />
          <button type="submit" class="btn btn-primary mt-2"><i class="fas fa-upload me-2"></i> Unggah & Muat Data Baru</button>
          <div class="form-text">Pastikan data Anda memiliki kolom untuk setiap jenis kain dan baris untuk periode waktu.</div>
        </form>

        <h2 class="card-title text-success mt-4">2. Input Prediksi Stok</h2>
        <form method="POST">
          <div class="factor-group">
            <p class="fw-bold">Sesuaikan Faktor Perhitungan:</p>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="safety_factor" class="form-label">Safety Stock Factor</label>
                <input type="number" id="safety_factor" name="safety_factor" value="{{ safety_factor_value if safety_factor_value is not none else 0.5 }}" step="0.1" min="0" class="form-control" required />
              </div>
              <div class="col-md-6 mb-3">
                <label for="reorder_factor" class="form-label">Reorder Point Factor</label>
                <input type="number" id="reorder_factor" name="reorder_factor" value="{{ reorder_factor_value if reorder_factor_value is not none else 1.5 }}" step="0.1" min="1" class="form-control" required />
              </div>
            </div>
          </div>

          <p class="fw-bold mt-4">Masukkan Stok Kain Saat Ini (dalam meter):</p>
          <div class="row">
            {% if nama_kain %} {% for kain in nama_kain %}
            <div class="col-md-4 mb-3">
              <label for="{{ kain }}" class="form-label fw-bold">{{ kain.replace('_', ' ') }}</label>
              <input type="number" id="{{ kain }}" name="{{ kain }}" value="0" min="0" class="form-control" required />
            </div>
            {% endfor %} {% else %}
            <p class="text-danger">Tidak ada data kain yang dimuat. Harap unggah file CSV yang valid.</p>
            {% endif %}
          </div>

          <button type="submit" class="btn btn-success btn-lg mt-3 w-100" {% if not nama_kain %}disabled{% endif %}><i class="fas fa-chart-line me-2"></i> Hitung Prediksi & Rekomendasi</button>
        </form>
      </div>

      {% if hasil %}
      <div class="card shadow-lg p-4 mt-5">
        <h2 class="card-title text-success">
          ðŸ“‹ Hasil Analisis dan Rekomendasi Stok<a href="{{ url_for('download_file') }}" class="btn btn-warning btn-sm float-end" role="button"> <i class="fas fa-file-excel me-1"></i> Download Excel</a>
        </h2>
        <div class="table-responsive">
          <table class="table table-hover table-bordered align-middle">
            <thead class="table-primary">
              <tr>
                <th>Jenis Kain</th>
                <th>Rata-Rata Jual (m)</th>
                <th>Safety Stock (m)</th>
                <th>Reorder Point (m)</th>
                <th>Stok Saat Ini (m)</th>
                <th>Rekomendasi</th>
              </tr>
            </thead>
            <tbody>
              {% for row in hasil %} {% set rekomendasi_class = '' %} {% if 'Kritis' in row.Rekomendasi %} {% set rekomendasi_class = 'kritis' %} {% elif 'Waktunya' in row.Rekomendasi %} {% set rekomendasi_class = 'perlu' %} {% elif 'Aman'
              in row.Rekomendasi %} {% set rekomendasi_class = 'aman' %} {% endif %}

              <tr class="{{ rekomendasi_class }}">
                <td>{{ row.Jenis_Kain.replace('_', ' ') }}</td>
                <td>{{ row.Rata_Rata_Jual | round(0) }}</td>
                <td>{{ row.Safety_Stock }}</td>
                <td>{{ row.Reorder_Point }}</td>
                <td>{{ row.Stok_Saat_Ini }}</td>
                <td>{{ row.Rekomendasi }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  </body>
</html>
